import{d as D,Z as x,r as _,c as h,o as b,w as l,a as i,b as t,i as R,Q as d,e as L,f as r,t as c,j as w}from"./app-B9ngRPxC.js";import{Q as q}from"./QInput-CJt-xT-X.js";import{Q as v,a as S}from"./QSelect-U9GO-vcy.js";import{_ as A,Q as f,a as p}from"./_plugin-vue_export-helper-DE_L9tpe.js";import{Q as F,a as m}from"./QTable-BWQ-_2Rh.js";import{Q as g}from"./QTooltip-BzpgTjjf.js";import{Q as C}from"./QCardActions-BXiB0Jwk.js";import{Q as V}from"./QDialog-Bd7-soYq.js";import{A as U,C as I}from"./Authenticated-Bi_brb96.js";import"./use-key-composition-CcPeSjoe.js";import"./use-id-Bsf40j7l.js";import"./focus-manager-BJWzFvJg.js";import"./QItem-DGC_oh8H.js";import"./QItemSection-Dr7pKUWg.js";import"./QItemLabel-CDx0sUKF.js";import"./format-DSaZ9Sxz.js";import"./QList-CauX3dmB.js";import"./use-timeout-BLTl8fd9.js";import"./use-model-toggle-D3uVg552.js";import"./QSeparator-DlYTESWS.js";import"./QLinearProgress-azICafWN.js";import"./QCheckbox-C-madECj.js";import"./use-checkbox-D0S0Xvb9.js";import"./QToolbar-tVFOb00I.js";import"./QBtnGroup-uFzmfQIw.js";import"./touch-BjYP5sR0.js";const N={components:{AuthenticatedLayout:U,Link:x},props:{instances:Object,filters:Object},data(){return{showRestartDialog:!1,showStopDialog:!1,selectedInstance:null,actionLoading:!1,columns:[{name:"fly_app_id",label:"Instance",field:"fly_app_id",align:"left"},{name:"type",label:"Type",field:"type",align:"center"},{name:"region",label:"Region",field:"region",align:"left"},{name:"status",label:"Status",field:"status",align:"center"},{name:"created_at",label:"Created",field:"created_at",align:"left"},{name:"actions",label:"Actions",align:"center"}],typeOptions:[{label:"SQL",value:"sql"},{label:"SAS",value:"sas"}],statusOptions:[{label:"Running",value:"running"},{label:"Stopped",value:"stopped"},{label:"Partial",value:"partial"},{label:"Not Deployed",value:"not_deployed"},{label:"No Machines",value:"no_machines"}]}},computed:{tablePagination(){return{page:this.instances.current_page,rowsPerPage:this.instances.per_page,rowsNumber:this.instances.total}}},methods:{formatDate(s){return new Date(s).toLocaleDateString()},getStatusColor(s){return{running:"positive",stopped:"negative",partial:"warning",not_deployed:"grey",no_machines:"grey"}[s]||"grey"},applyFilters(){this.$inertia.get(route("instances.index"),this.filters,{preserveState:!0,preserveScroll:!0})},debouncedSearch:D(function(){this.applyFilters()},500),onRequest(s){const{page:a}=s.pagination;this.$inertia.get(route("instances.index"),{...this.filters,page:a},{preserveState:!0,preserveScroll:!0})},viewInstance(s){this.$inertia.visit(route("instances.show",s))},confirmRestart(s){this.selectedInstance=s,this.showRestartDialog=!0},confirmStop(s){this.selectedInstance=s,this.showStopDialog=!0},restartInstance(){this.actionLoading=!0,this.$inertia.post(route("instances.restart",this.selectedInstance.id),{},{preserveScroll:!0,onSuccess:()=>{this.$q.notify({type:"positive",message:"Instance restart initiated"}),this.showRestartDialog=!1},onError:()=>{this.$q.notify({type:"negative",message:"Failed to restart instance"})},onFinish:()=>{this.actionLoading=!1}})},stopInstance(){this.actionLoading=!0,this.$inertia.post(route("instances.stop",this.selectedInstance.id),{},{preserveScroll:!0,onSuccess:()=>{this.$q.notify({type:"positive",message:"Instance stopped"}),this.showStopDialog=!1},onError:()=>{this.$q.notify({type:"negative",message:"Failed to stop instance"})},onFinish:()=>{this.actionLoading=!1}})},syncAll(){this.$inertia.post(route("fly-sync.run"),{},{preserveScroll:!0,onSuccess:()=>{this.$q.notify({type:"positive",message:"Sync job dispatched for all clients"})}})}}},O={class:"q-gutter-md"},P={class:"row items-center justify-between q-mb-md"},T={class:"row q-col-gutter-md"},j={class:"col-12 col-md-3"},z={class:"col-12 col-md-3"},B={class:"col-12 col-md-3"},E={class:"text-weight-medium"},M={class:"text-caption text-grey-7"};function Z(s,a,u,G,n,o){const Q=_("Link"),k=_("AuthenticatedLayout");return b(),h(k,null,{default:l(()=>[i("div",O,[i("div",P,[a[5]||(a[5]=i("div",{class:"text-h5"},"Instances",-1)),s.$page.props.auth.user.role==="admin"?(b(),h(d,{key:0,color:"primary",icon:"mdi-sync",label:"Sync All",onClick:o.syncAll},null,8,["onClick"])):R("",!0)]),t(f,null,{default:l(()=>[t(p,null,{default:l(()=>[i("div",T,[i("div",j,[t(q,{modelValue:u.filters.search,"onUpdate:modelValue":[a[0]||(a[0]=e=>u.filters.search=e),o.debouncedSearch],label:"Search instances",filled:"",clearable:""},{prepend:l(()=>[t(L,{name:"mdi-magnify"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),i("div",z,[t(v,{modelValue:u.filters.type,"onUpdate:modelValue":[a[1]||(a[1]=e=>u.filters.type=e),o.applyFilters],options:n.typeOptions,label:"Filter by Type",filled:"","emit-value":"","map-options":"",clearable:""},null,8,["modelValue","options","onUpdate:modelValue"])]),i("div",B,[t(v,{modelValue:u.filters.status,"onUpdate:modelValue":[a[2]||(a[2]=e=>u.filters.status=e),o.applyFilters],options:n.statusOptions,label:"Filter by Status",filled:"","emit-value":"","map-options":"",clearable:""},null,8,["modelValue","options","onUpdate:modelValue"])])])]),_:1})]),_:1}),t(f,null,{default:l(()=>[t(F,{rows:u.instances.data,columns:n.columns,"row-key":"id",flat:"",pagination:o.tablePagination,onRequest:o.onRequest},{"body-cell-fly_app_id":l(e=>[t(m,{props:e},{default:l(()=>[i("div",null,[i("div",E,c(e.row.fly_app_id),1),i("div",M,[t(Q,{href:s.route("clients.show",e.row.client.id),class:"text-primary"},{default:l(()=>[r(c(e.row.client.name),1)]),_:2},1032,["href"])])])]),_:2},1032,["props"])]),"body-cell-type":l(e=>[t(m,{props:e},{default:l(()=>[t(S,{size:"sm",color:"primary"},{default:l(()=>[r(c(e.row.type.toUpperCase()),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-status":l(e=>[t(m,{props:e},{default:l(()=>[t(S,{color:o.getStatusColor(e.row.status),"text-color":"white",size:"sm"},{default:l(()=>[r(c(e.row.status),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-created_at":l(e=>[t(m,{props:e},{default:l(()=>[r(c(o.formatDate(e.row.created_at)),1)]),_:2},1032,["props"])]),"body-cell-actions":l(e=>[t(m,{props:e},{default:l(()=>[t(d,{size:"sm",flat:"",dense:"",icon:"mdi-eye",onClick:y=>o.viewInstance(e.row.id)},{default:l(()=>[t(g,null,{default:l(()=>a[6]||(a[6]=[r("View Details",-1)])),_:1,__:[6]})]),_:2},1032,["onClick"]),t(d,{size:"sm",flat:"",dense:"",icon:"mdi-restart",color:"warning",onClick:y=>o.confirmRestart(e.row),disable:e.row.status!=="running"},{default:l(()=>[t(g,null,{default:l(()=>a[7]||(a[7]=[r("Restart",-1)])),_:1,__:[7]})]),_:2},1032,["onClick","disable"]),t(d,{size:"sm",flat:"",dense:"",icon:"mdi-stop",color:"negative",onClick:y=>o.confirmStop(e.row),disable:e.row.status==="stopped"},{default:l(()=>[t(g,null,{default:l(()=>a[8]||(a[8]=[r("Stop",-1)])),_:1,__:[8]})]),_:2},1032,["onClick","disable"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination","onRequest"])]),_:1}),t(V,{modelValue:n.showRestartDialog,"onUpdate:modelValue":a[3]||(a[3]=e=>n.showRestartDialog=e)},{default:l(()=>[t(f,{style:{"min-width":"300px"}},{default:l(()=>[t(p,null,{default:l(()=>a[9]||(a[9]=[i("div",{class:"text-h6"},"Restart Instance",-1)])),_:1,__:[9]}),t(p,null,{default:l(()=>{var e;return[r(' Are you sure you want to restart "'+c((e=n.selectedInstance)==null?void 0:e.fly_app_id)+'"? ',1)]}),_:1}),t(C,{align:"right"},{default:l(()=>[w(t(d,{flat:"",label:"Cancel"},null,512),[[I]]),t(d,{flat:"",label:"Restart",color:"warning",onClick:o.restartInstance,loading:n.actionLoading},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(V,{modelValue:n.showStopDialog,"onUpdate:modelValue":a[4]||(a[4]=e=>n.showStopDialog=e)},{default:l(()=>[t(f,{style:{"min-width":"300px"}},{default:l(()=>[t(p,null,{default:l(()=>a[10]||(a[10]=[i("div",{class:"text-h6"},"Stop Instance",-1)])),_:1,__:[10]}),t(p,null,{default:l(()=>{var e;return[r(' Are you sure you want to stop "'+c((e=n.selectedInstance)==null?void 0:e.fly_app_id)+'"? All machines will be stopped. ',1)]}),_:1}),t(C,{align:"right"},{default:l(()=>[w(t(d,{flat:"",label:"Cancel"},null,512),[[I]]),t(d,{flat:"",label:"Stop",color:"negative",onClick:o.stopInstance,loading:n.actionLoading},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})}const be=A(N,[["render",Z]]);export{be as default};
