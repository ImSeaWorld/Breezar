import{r as y,c as v,o as p,w as e,a as i,t as a,b as t,Q as g,g as h,i as S,f as r,R as k,S as w,L as O}from"./app-B9ngRPxC.js";import{_ as E,Q as _,a as c}from"./_plugin-vue_export-helper-DE_L9tpe.js";import{Q as V}from"./QSeparator-DlYTESWS.js";import{Q as L}from"./QSelect-U9GO-vcy.js";import{Q as B}from"./QForm-QL7SKRAj.js";import{Q as u}from"./QItemLabel-CDx0sUKF.js";import{Q as f}from"./QItemSection-Dr7pKUWg.js";import{Q as x}from"./QItem-DGC_oh8H.js";import{Q}from"./QList-CauX3dmB.js";import{Q as N}from"./QExpansionItem-DTY6VFuz.js";import{A as F}from"./Authenticated-Bi_brb96.js";import{C as A}from"./CodeMirrorEditor-ULlk9JEz.js";import"./use-key-composition-CcPeSjoe.js";import"./use-id-Bsf40j7l.js";import"./focus-manager-BJWzFvJg.js";import"./format-DSaZ9Sxz.js";import"./use-model-toggle-D3uVg552.js";import"./use-timeout-BLTl8fd9.js";import"./QDialog-Bd7-soYq.js";import"./QToolbar-tVFOb00I.js";import"./QBtnGroup-uFzmfQIw.js";import"./touch-BjYP5sR0.js";const D={components:{AuthenticatedLayout:F,CodeMirrorEditor:A},props:{script:Object,clients:Array},data(){var n;return{executing:!1,executionOutput:((n=this.$page.props.flash)==null?void 0:n.execution_output)||null,executeForm:O({client_id:null}),editorOptions:{mode:"text/x-php",theme:"material-darker",lineNumbers:!0,lineWrapping:!0,readOnly:!0,indentUnit:4,tabSize:4}}},computed:{clientOptions(){return(this.clients||this.$page.props.clients||[]).map(l=>({label:l.name,value:l.id}))}},methods:{formatDate(n){return new Date(n).toLocaleString()},executeScript(){this.executing=!0,this.executeForm.post(route("scripts.execute",this.script.id),{preserveScroll:!0,onSuccess:n=>{var l;this.$q.notify({type:"positive",message:"Script executed successfully"}),this.executionOutput=((l=n.props.flash)==null?void 0:l.execution_output)||"Script executed with no output"},onError:()=>{this.$q.notify({type:"negative",message:"Script execution failed"})},onFinish:()=>{this.executing=!1}})}},mounted(){!this.clients&&!this.$page.props.clients&&this.$inertia.reload({only:["clients"]})}},I={class:"q-gutter-md"},U={class:"row items-center justify-between q-mb-md"},j={class:"text-h5"},M={class:"text-caption text-grey-7"},R={class:"row q-col-gutter-md"},T={class:"col-12 col-lg-8"},z={class:"row q-col-gutter-md items-end"},W={class:"col-12 col-md-8"},G={class:"col-12 col-md-4"},H={key:0,class:"q-mt-md"},J={class:"q-ma-none execution-output"},K={class:"col-12 col-lg-4"},P={class:"q-ma-none execution-output text-caption"};function X(n,l,s,Y,d,m){const q=y("CodeMirrorEditor"),C=y("AuthenticatedLayout");return p(),v(C,null,{default:e(()=>[i("div",I,[i("div",U,[i("div",null,[i("div",j,a(s.script.name),1),i("div",M,a(s.script.description),1)]),i("div",null,[t(g,{color:"primary",icon:"mdi-pencil",label:"Edit",onClick:l[0]||(l[0]=o=>n.$inertia.visit(n.route("scripts.edit",s.script.id))),class:"q-mr-sm"}),t(g,{color:"secondary",icon:"mdi-arrow-left",label:"Back",onClick:l[1]||(l[1]=o=>n.$inertia.visit(n.route("scripts.index")))})])]),i("div",R,[i("div",T,[t(_,null,{default:e(()=>[t(c,null,{default:e(()=>[l[3]||(l[3]=i("div",{class:"text-h6 q-mb-md"},"Script Code",-1)),t(q,{modelValue:s.script.tinker_code,options:d.editorOptions,"onUpdate:modelValue":()=>{}},null,8,["modelValue","options"])]),_:1,__:[3]}),t(V),t(c,null,{default:e(()=>[l[5]||(l[5]=i("div",{class:"text-h6 q-mb-md"},"Execute Script",-1)),t(B,{onSubmit:m.executeScript},{default:e(()=>[i("div",z,[i("div",W,[t(L,{modelValue:d.executeForm.client_id,"onUpdate:modelValue":l[2]||(l[2]=o=>d.executeForm.client_id=o),options:m.clientOptions,label:"Select Client (Optional)",filled:"","emit-value":"","map-options":"",clearable:"",hint:"Select a client to inject $client variable"},null,8,["modelValue","options"])]),i("div",G,[t(g,{type:"submit",color:"positive",icon:"mdi-play",label:"Execute",loading:d.executing,class:"full-width"},null,8,["loading"])])])]),_:1},8,["onSubmit"]),d.executionOutput?(p(),h("div",H,[l[4]||(l[4]=i("div",{class:"text-subtitle2 q-mb-sm"},"Output:",-1)),t(_,{flat:"",bordered:""},{default:e(()=>[t(c,null,{default:e(()=>[i("pre",J,a(d.executionOutput),1)]),_:1})]),_:1})])):S("",!0)]),_:1,__:[5]})]),_:1})]),i("div",K,[t(_,null,{default:e(()=>[t(c,null,{default:e(()=>[l[10]||(l[10]=i("div",{class:"text-h6 q-mb-md"},"Script Information",-1)),t(Q,null,{default:e(()=>[t(x,null,{default:e(()=>[t(f,null,{default:e(()=>[t(u,{caption:""},{default:e(()=>l[6]||(l[6]=[r("Created By",-1)])),_:1,__:[6]}),t(u,null,{default:e(()=>{var o;return[r(a(((o=s.script.creator)==null?void 0:o.name)||"Unknown"),1)]}),_:1})]),_:1})]),_:1}),t(x,null,{default:e(()=>[t(f,null,{default:e(()=>[t(u,{caption:""},{default:e(()=>l[7]||(l[7]=[r("Created At",-1)])),_:1,__:[7]}),t(u,null,{default:e(()=>[r(a(m.formatDate(s.script.created_at)),1)]),_:1})]),_:1})]),_:1}),t(x,null,{default:e(()=>[t(f,null,{default:e(()=>[t(u,{caption:""},{default:e(()=>l[8]||(l[8]=[r("Last Run",-1)])),_:1,__:[8]}),t(u,null,{default:e(()=>[r(a(s.script.last_run_at?m.formatDate(s.script.last_run_at):"Never"),1)]),_:1})]),_:1})]),_:1}),t(x,null,{default:e(()=>[t(f,null,{default:e(()=>[t(u,{caption:""},{default:e(()=>l[9]||(l[9]=[r("Total Executions",-1)])),_:1,__:[9]}),t(u,null,{default:e(()=>{var o;return[r(a(((o=s.script.executions)==null?void 0:o.length)||0),1)]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1,__:[10]})]),_:1}),t(_,{class:"q-mt-md"},{default:e(()=>[t(c,null,{default:e(()=>[l[12]||(l[12]=i("div",{class:"text-h6 q-mb-md"},"Recent Executions",-1)),t(Q,null,{default:e(()=>[(p(!0),h(k,null,w(s.script.executions,o=>{var b;return p(),v(N,{key:o.id,group:"executions",label:m.formatDate(o.executed_at),caption:`By ${((b=o.executor)==null?void 0:b.name)||"Unknown"}${o.client?" - "+o.client.name:""}`},{default:e(()=>[t(_,null,{default:e(()=>[t(c,null,{default:e(()=>[i("pre",P,a(o.output||"No output"),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["label","caption"])}),128)),!s.script.executions||s.script.executions.length===0?(p(),v(x,{key:0},{default:e(()=>[t(f,null,{default:e(()=>[t(u,{class:"text-grey-6"},{default:e(()=>l[11]||(l[11]=[r("No execution history",-1)])),_:1,__:[11]})]),_:1})]),_:1})):S("",!0)]),_:1})]),_:1,__:[12]})]),_:1})])])])]),_:1})}const yt=E(D,[["render",X]]);export{yt as default};
