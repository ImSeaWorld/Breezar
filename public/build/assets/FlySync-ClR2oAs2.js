import{Q as v,a as y}from"./_plugin-vue_export-helper-DE_L9tpe.js";import{Q as x}from"./QSeparator-DlYTESWS.js";import{Q as b}from"./QItemLabel-CDx0sUKF.js";import{Q as k}from"./QItemSection-Dr7pKUWg.js";import{Q as V}from"./QItem-DGC_oh8H.js";import{Q as A,a as N}from"./QSelect-U9GO-vcy.js";import{E as g,p as P,c as T,o as s,w as t,a as l,b as a,O as q,P as B,f as r,t as n,Q as D,g as c,i as d,X as F}from"./app-B9ngRPxC.js";import{Q as E,a as p}from"./QTable-BWQ-_2Rh.js";import{u as I}from"./use-quasar-BSYRNlz7.js";import{A as z}from"./Authenticated-Bi_brb96.js";import"./use-key-composition-CcPeSjoe.js";import"./use-id-Bsf40j7l.js";import"./focus-manager-BJWzFvJg.js";import"./format-DSaZ9Sxz.js";import"./QList-CauX3dmB.js";import"./use-timeout-BLTl8fd9.js";import"./use-model-toggle-D3uVg552.js";import"./QDialog-Bd7-soYq.js";import"./QLinearProgress-azICafWN.js";import"./QCheckbox-C-madECj.js";import"./use-checkbox-D0S0Xvb9.js";import"./QToolbar-tVFOb00I.js";import"./QBtnGroup-uFzmfQIw.js";import"./touch-BjYP5sR0.js";const H={class:"q-gutter-md"},L={class:"row q-col-gutter-md"},$={class:"col-12 col-md-6"},j={class:"col-12 col-md-6"},O={key:0},R={key:0},U={key:1,class:"text-negative"},M={key:2},ve={__name:"FlySync",props:{syncHistory:Array,clients:Array},setup(_){const w=_,f=I(),m=g(null),u=g(!1),Q=[{name:"action",label:"Status",field:"action",align:"left"},{name:"client",label:"Client",field:"client",align:"left"},{name:"user",label:"User",field:"user",align:"left"},{name:"metadata",label:"Details",field:"metadata",align:"left"},{name:"created_at",label:"Date/Time",field:"created_at",align:"left"}],S=P(()=>[{label:"All Active Clients",value:null,instances_count:"all"},...w.clients.map(o=>({label:`${o.name} (${o.fly_org_id})`,value:o.id,instances_count:o.instances_count}))]),h=o=>new Date(o).toLocaleString(),C=async()=>{u.value=!0;try{await F.post(route("fly-sync.run"),{client_id:m.value},{preserveScroll:!0,onSuccess:()=>{f.notify({type:"positive",message:"Sync job has been dispatched"})},onError:()=>{f.notify({type:"negative",message:"Failed to dispatch sync job"})}})}finally{u.value=!1}};return(o,i)=>(s(),T(z,null,{default:t(()=>[l("div",H,[a(v,null,{default:t(()=>[a(y,null,{default:t(()=>i[1]||(i[1]=[l("div",{class:"text-h6 q-mb-md"},"Fly.io Sync Management",-1),l("p",{class:"text-body2 text-grey-8"}," Synchronize Fly.io instances with the local database. The sync runs automatically every 30 minutes. ",-1)])),_:1,__:[1]}),a(x),a(y,null,{default:t(()=>[l("div",L,[l("div",$,[a(A,{modelValue:m.value,"onUpdate:modelValue":i[0]||(i[0]=e=>m.value=e),options:S.value,label:"Select Client (optional)",clearable:"",filled:"","emit-value":"","map-options":"","option-value":"value","option-label":"label"},{option:t(e=>[a(V,q(B(e.itemProps)),{default:t(()=>[a(k,null,{default:t(()=>[a(b,null,{default:t(()=>[r(n(e.opt.label),1)]),_:2},1024),a(b,{caption:""},{default:t(()=>[r(n(e.opt.instances_count)+" instances ",1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])]),l("div",j,[a(D,{color:"primary",label:"Run Sync Now",icon:"mdi-sync",onClick:C,loading:u.value,class:"full-width"},null,8,["loading"])])])]),_:1})]),_:1}),a(v,null,{default:t(()=>[a(y,null,{default:t(()=>[i[2]||(i[2]=l("div",{class:"text-h6 q-mb-md"},"Sync History",-1)),a(E,{rows:_.syncHistory,columns:Q,"row-key":"id",pagination:{rowsPerPage:15},flat:"",bordered:""},{"body-cell-action":t(e=>[a(p,{props:e},{default:t(()=>[a(N,{color:e.row.action==="fly_sync_completed"?"positive":"negative","text-color":"white",size:"sm",dense:""},{default:t(()=>[r(n(e.row.action==="fly_sync_completed"?"Completed":"Failed"),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-metadata":t(e=>[a(p,{props:e},{default:t(()=>[e.row.metadata?(s(),c("div",O,[e.row.metadata.synced_count?(s(),c("div",R," Synced: "+n(e.row.metadata.synced_count)+" instances ",1)):d("",!0),e.row.metadata.error?(s(),c("div",U," Error: "+n(e.row.metadata.error),1)):d("",!0),e.row.metadata.initiated_by?(s(),c("div",M," Initiated by: "+n(e.row.metadata.initiated_by),1)):d("",!0)])):d("",!0)]),_:2},1032,["props"])]),"body-cell-created_at":t(e=>[a(p,{props:e},{default:t(()=>[r(n(h(e.row.created_at)),1)]),_:2},1032,["props"])]),_:1},8,["rows"])]),_:1,__:[2]})]),_:1})])]),_:1}))}};export{ve as default};
